# ðŸ—ºï¸ MAPA DEL SISTEMA - ARQUITECTURA VISUAL

## ðŸ—ï¸ Arquitectura de Alto Nivel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TU MÃQUINA (Windows 10)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PowerShell / Terminal                                          â”‚
â”‚  â”œâ”€ docker-compose up -d                                        â”‚
â”‚  â”œâ”€ python seed_data.py                                         â”‚
â”‚  â””â”€ python demo_queries.py                                      â”‚
â”‚                                                                 â”‚
â”‚  Navegador                                                      â”‚
â”‚  â””â”€ http://localhost:8080 (pgAdmin)                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DOCKER DESKTOP                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Network: nuevaapp_default                                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Container: app_db      â”‚  â”‚ Container: app_pgadmin   â”‚   â”‚
â”‚  â”‚   (PostgreSQL 18.1)      â”‚  â”‚ (pgAdmin 4)              â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚  Port: 5432 â†’ 5432       â”‚  â”‚ Port: 80 â†’ 8080          â”‚   â”‚
â”‚  â”‚  User: appuser           â”‚  â”‚ User: admin@example.com  â”‚   â”‚
â”‚  â”‚  DB: appdb               â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚ Conecta a â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚   Volume: postgres_data  â”‚                                   â”‚
â”‚  â”‚   Ruta: /var/lib/...     â”‚                                   â”‚
â”‚  â”‚   Persistencia: âœ…        â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—„ï¸ Diagrama de Tablas y Relaciones

```
                        ESQUEMA: appdb
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                         â”‚
    â”‚  suppliers                    products                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
    â”‚  â”‚ id (UUID)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ id_proveedor â”‚          â”‚
    â”‚  â”‚ nombre       â”‚    FK      â”‚ id (UUID)    â”‚          â”‚
    â”‚  â”‚ contacto     â”‚            â”‚ sku (UNIQUE) â”‚          â”‚
    â”‚  â”‚ estado       â”‚            â”‚ nombre       â”‚          â”‚
    â”‚  â”‚ (50 filas)   â”‚            â”‚ precio       â”‚          â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ stock >= 0   â”‚          â”‚
    â”‚         â–³                    â”‚ (200 filas)  â”‚          â”‚
    â”‚         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
    â”‚         â”‚                           â–³                 â”‚
    â”‚         â”‚                           â”‚                 â”‚
    â”‚         â”‚                inventory_movements           â”‚
    â”‚         â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚         â”‚                â”‚ id (UUID)    â”‚             â”‚
    â”‚         â”‚        FKâ”€â”€â”€â”€â”€â”€â”‚ id_producto  â”‚             â”‚
    â”‚         â”‚                â”‚ tipo         â”‚             â”‚
    â”‚         â”‚                â”‚ cantidad > 0 â”‚             â”‚
    â”‚         â”‚                â”‚ fecha        â”‚             â”‚
    â”‚         â”‚                â”‚ (146 filas)  â”‚             â”‚
    â”‚         â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
    â”‚         â”‚                         â–³                   â”‚
    â”‚         â”‚                         â”‚                   â”‚
    â”‚         â”‚                    Trigger:                 â”‚
    â”‚         â”‚              fn_adjust_stock                â”‚
    â”‚         â”‚                         â†“                   â”‚
    â”‚         â”‚                   Decrementa               â”‚
    â”‚         â”‚                   products.stock            â”‚
    â”‚         â”‚                                            â”‚
    â”‚         â”‚        operations_log                       â”‚
    â”‚         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
    â”‚         â”‚        â”‚ id (UUID)    â”‚                     â”‚
    â”‚         â”‚        â”‚ tipo_operacion                     â”‚
    â”‚         â”‚        â”‚ fecha        â”‚                     â”‚
    â”‚         â”‚        â”‚ detalles(JSONB)                    â”‚
    â”‚         â”‚        â”‚ (409 filas)  â”‚                     â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚                     â”‚
    â”‚              â†‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
    â”‚              â”‚                                         â”‚
    â”‚              â””â”€ Audit Trigger:                        â”‚
    â”‚                 fn_products_stock_audit               â”‚
    â”‚                                                       â”‚
    â”‚  orders                    order_lines                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
    â”‚  â”‚ id (UUID)    â”‚â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”‚ order_id (FK)â”‚           â”‚
    â”‚  â”‚ order_number â”‚    â”‚    â”‚ product_id   â”‚â”€â”€â”€â”       â”‚
    â”‚  â”‚ cliente      â”‚    â”‚    â”‚ (FK CASCADE) â”‚   â”‚       â”‚
    â”‚  â”‚ total        â”‚    â”‚    â”‚ cantidad > 0 â”‚   â”‚       â”‚
    â”‚  â”‚ estado       â”‚    â”‚    â”‚ precio_unit  â”‚   â”‚       â”‚
    â”‚  â”‚ (17 filas)   â”‚    â”‚    â”‚ subtotal     â”‚   â”‚       â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚ (~60 filas)  â”‚   â”‚       â”‚
    â”‚         â–³            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
    â”‚         â”‚            â”‚           â–³           â”‚       â”‚
    â”‚         â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
    â”‚         â”‚                  â”‚                 â”‚       â”‚
    â”‚         â””â”€â”€ FunciÃ³n ACID â”€â”€â”´â”€â”€ fn_create_order       â”‚
    â”‚            â€¢ Bloquea filas (SELECT...FOR UPDATE)     â”‚
    â”‚            â€¢ Valida stock                            â”‚
    â”‚            â€¢ Inserta orden + lÃ­neas + logs           â”‚
    â”‚            â€¢ Decrementa stock (via trigger)          â”‚
    â”‚            â€¢ Todo o nada (ROLLBACK en error)         â”‚
    â”‚                                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Leyenda:
  â”€â”€â”€â”€â”€  Foreign Key
  â”€â”€â”€â”€â”¤  Trigger  
  â”€â”€â”€â”€â”¬  FunciÃ³n ACID
  â—„â”€â”€â”€  References
```

---

## ðŸ”„ Flujo de Datos: Crear una Orden

```
User App (Python)
â”‚
â””â”€â–º SELECT fn_create_order('Cliente XYZ', lines_JSONB)
    â”‚
    â”œâ”€â–º START TRANSACTION
    â”‚
    â”œâ”€â–º FOR EACH line IN lines:
    â”‚   â”œâ”€â–º SELECT stock FROM products WHERE id = ? FOR UPDATE
    â”‚   â”‚   (Bloquea fila hasta fin de transacciÃ³n)
    â”‚   â”‚
    â”‚   â”œâ”€â–º IF cantidad > stock THEN RAISE EXCEPTION
    â”‚   â”‚   (Termina transacciÃ³n, ROLLBACK)
    â”‚   â”‚
    â”‚   â””â”€â–º Calcula subtotal, suma a total
    â”‚
    â”œâ”€â–º INSERT INTO orders (...)
    â”‚
    â”œâ”€â–º FOR EACH line IN lines:
    â”‚   â”œâ”€â–º INSERT INTO order_lines (...)
    â”‚   â”‚
    â”‚   â”œâ”€â–º UPDATE products SET stock = stock - cantidad
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â–º TRIGGER: fn_products_stock_audit()
    â”‚   â”‚       â””â”€â–º INSERT INTO operations_log (tipo='stock_update')
    â”‚   â”‚
    â”‚   â””â”€â–º INSERT INTO inventory_movements (tipo='salida')
    â”‚       â”‚
    â”‚       â””â”€â–º TRIGGER: fn_adjust_stock_from_movement()
    â”‚           â””â”€â–º UPDATE products SET stock (ya se hizo arriba)
    â”‚
    â”œâ”€â–º INSERT INTO operations_log (tipo='order_created')
    â”‚
    â””â”€â–º COMMIT TRANSACTION
        (Libera bloqueos, confirma todos los cambios)

Resultado:
  âœ… Si todo OK: 1 orden + lÃ­neas + movimientos + logs creados
  âŒ Si falla en lÃ­nea N: ROLLBACK automÃ¡tico (estado original intacto)
```

---

## ðŸŽ¯ Flujo de Uso Diario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MaÃ±ana: Setup                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Abre PowerShell                                         â”‚
â”‚ 2. cd "Nueva App"                                          â”‚
â”‚ 3. docker-compose up -d                                    â”‚
â”‚ 4. Espera 30s                                              â”‚
â”‚ â””â”€â–º âœ… Sistema listo                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Usar: pgAdmin (visualmente)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Abre http://localhost:8080                              â”‚
â”‚ 2. Login: admin@example.com / AdminPass123!               â”‚
â”‚ 3. Conecta a servidor "db"                                 â”‚
â”‚ 4. Navega a Tables â†’ ordena, products, etc.                â”‚
â”‚ 5. Ejecuta SQL en Query Tool                               â”‚
â”‚ â””â”€â–º âœ… Visualiza datos en tiempo real                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” DÃ³nde Se Garantiza ACID

```
Atomicidad
  â”œâ”€ FunciÃ³n PL/pgSQL: fn_create_order()
  â”‚  â””â”€ Envuelve TODO en una transacciÃ³n SQL
  â”œâ”€ Python: autocommit=False (por defecto en psycopg2)
  â”‚  â””â”€ Si excepciÃ³n: conn.rollback()
  â””â”€ Resultado: Todo o nada âœ…

Consistencia
  â”œâ”€ CHECK constraints: stock >= 0, cantidad > 0
  â”‚  â””â”€ DB rechaza violaciones
  â”œâ”€ Foreign Keys: ON DELETE RESTRICT/CASCADE
  â”‚  â””â”€ DB previene orfandad
  â”œâ”€ Triggers: fn_products_stock_audit()
  â”‚  â””â”€ Sincroniza stock automÃ¡ticamente
  â””â”€ Resultado: Datos siempre vÃ¡lidos âœ…

Aislamiento
  â”œâ”€ SELECT ... FOR UPDATE: bloquea filas
  â”‚  â””â”€ Previene lecturas sucias en Ã³rdenes concurrentes
  â”œâ”€ Default: READ COMMITTED
  â”‚  â””â”€ Suficiente para este caso de uso
  â””â”€ Resultado: Sin race conditions âœ…

Durabilidad
  â”œâ”€ PostgreSQL WAL: Write-Ahead Logging
  â”‚  â””â”€ Escribe a disco antes de confirmar
  â”œâ”€ Volumen Docker: /var/lib/postgresql
  â”‚  â””â”€ Persiste incluso si contenedor cae
  â””â”€ Resultado: Datos nunca se pierden âœ…
```

---

**Ãšltima actualizaciÃ³n:** 15 de Enero de 2026
